name: Build Neovim AppImage (arm64 Ubuntu20.04)

on:
  workflow_dispatch:
  push:
    tags:
      - 'stable'
  schedule: # monthly
    - cron: '0 0 1 * *'

jobs:
  build:
    runs-on: ubuntu-24.04-arm
    env:
      NEOVIM_BRANCH: stable
    steps:
      - name: Build in Ubuntu 20.04 container
        uses: addnab/docker-run-action@v3
        with:
          image: ubuntu:20.04
          options: -e DEBIAN_FRONTEND=noninteractive -v "${{ github.workspace }}:/workspace"
          run: |
            apt-get update && apt-get install -y --no-install-recommends \
              git \
              unzip \
              gettext \
              cmake \
              ninja-build \
              build-essential \
              ca-certificates

            git clone -b stable --single-branch --depth 1 https://github.com/neovim/neovim.git
            cd neovim && make CMAKE_BUILD_TYPE=RelWithDebInfo appimage
            mv build/bin/nvim-linux-*.appimage /workspace/nvim-linux-*.appimage

      - name: Upload AppImage artifact
        uses: actions/upload-artifact@v4
        with:
          name: appimage
          path: nvim-linux-*.appimage
          retention-days: 1

